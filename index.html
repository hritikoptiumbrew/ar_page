<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AR Model Placement</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@ar-js-org/ar.js@3.4.2/aframe/build/aframe-ar-nft.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.156.0/build/three.min.js"></script>
</head>

<body style="margin: 0; overflow: hidden;">
  <a-scene
    webxr="optionalFeatures: hit-test;"
    renderer="colorManagement: true;"
    vr-mode-ui="enabled: false"
    embedded>
    
    <!-- Load your GLB -->
    <a-entity id="placed-model"
      gltf-model="model.gltf"
      visible="false"
      scale="1 1 1">
    </a-entity>

    <a-camera></a-camera>

  </a-scene>

  <script>
    const scene = document.querySelector("a-scene");
    const model = document.querySelector("#placed-model");

    scene.addEventListener("click", (event) => {
      const frame = scene.xrSession;
      if (!frame) return;

      const viewerSpace = frame.viewerSpace;
      const hitTestSource = scene.systems.webxr.hitTestSource;

      frame.requestAnimationFrame(() => {
        const pose = frame.getViewerPose(scene.renderer.xr.getReferenceSpace());
        if (!pose || !hitTestSource) return;

        const hitResults = frame.getHitTestResults(hitTestSource);
        if (hitResults.length > 0) {
          const hitPose = hitResults[0].getPose(scene.renderer.xr.getReferenceSpace());
          model.setAttribute("position", `${hitPose.transform.position.x} ${hitPose.transform.position.y} ${hitPose.transform.position.z}`);
          model.setAttribute("visible", "true");
        }
      });
    });
  </script>
</body>
</html>
